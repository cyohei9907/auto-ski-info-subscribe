# 监控画面控制功能说明

## 新增功能概览

现在的账户管理页面提供了更强大的监控间隔控制功能：

### ✨ 核心功能

1. **📊 实时统计** - 直观显示各监控间隔的账户数量
2. **🔍 智能筛选** - 点击统计卡片快速筛选对应账户
3. **⚙️ 批量设置** - 一次性为多个账户设置相同的监控间隔
4. **✅ 多选操作** - 使用复选框选择需要批量操作的账户
5. **🎯 即时反馈** - 所有操作都有明确的视觉和消息反馈

## 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  アカウント管理                                   [更新] [追加]│
├─────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      │
│  │総アカウント│ │ 30分間隔  │ │ 1時間間隔 │ │ 4時間間隔 │      │
│  │    5     │ │    2     │ │    1     │ │    2     │      │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘      │
│  ┌──────────┐ ┌────────────────────────────────────┐      │
│  │12時間間隔 │ │ [一括設定 (0)] [フィルター] │      │
│  │    0     │ │                                      │      │
│  └──────────┘ └────────────────────────────────────┘      │
├─────────────────────────────────────────────────────────────┤
│  ☐  [@username]  [表示名]  [監視間隔▼]  [状態]  [操作]      │
│  ☐  [@username]  [表示名]  [監視間隔▼]  [状態]  [操作]      │
│  ...                                                         │
└─────────────────────────────────────────────────────────────┘
```

## 使用方法

### 1. 查看统计信息

页面顶部显示 5 个统计卡片：

- **総アカウント数** - 总账户数量（带 Twitter 图标）
- **30 分間隔** - 设置为 30 分钟间隔的账户数
- **1 時間間隔** - 设置为 1 小时间隔的账户数
- **4 時間間隔** - 设置为 4 小时间隔的账户数
- **12 時間間隔** - 设置为 12 小时间隔的账户数

### 2. 筛选账户

#### 点击统计卡片筛选

1. 点击任意监控间隔的统计卡片（例如"30 分間隔"）
2. 卡片边框变为蓝色，表格只显示该间隔的账户
3. 上方显示筛选标签：`[×] フィルター: 30分`
4. 再次点击同一卡片或点击标签的 `×` 取消筛选

**视觉反馈**：

- 选中的卡片：蓝色边框 + 蓝色数字
- 未选中的卡片：灰色边框 + 黑色数字

### 3. 批量设置监控间隔

#### 步骤：

1. **选择账户**

   - 勾选表格左侧的复选框
   - 可以选择一个或多个账户
   - 表头复选框可全选/取消全选

2. **打开批量菜单**

   - 点击"一括設定 (2)"按钮（数字显示选中数量）
   - 下拉菜单显示 4 个选项：
     - 30 分ごとに設定
     - 1 時間ごとに設定
     - 4 時間ごとに設定
     - 12 時間ごとに設定

3. **确认操作**

   - 点击任意选项后弹出确认对话框
   - 显示：`選択された2件のアカウントの監視間隔を変更しますか？`
   - 点击"変更"执行批量更新

4. **完成**
   - 显示成功消息："監視間隔を一括更新しました"
   - 自动刷新列表，清除选中状态
   - 统计卡片自动更新数字

#### 注意事项：

⚠️ 如果没有选择任何账户，点击"一括設定"按钮时会提示：`アカウントを選択してください`

### 4. 单个账户设置

在表格的"監視間隔"列，直接点击下拉菜单选择：

- 30 分ごと
- 1 時間ごと
- 4 時間ごと
- 12 時間ごと

立即保存并显示："監視間隔を更新しました"

## 功能特点

### 🎯 直观的数据可视化

统计卡片使用 Ant Design 的 `Statistic` 组件：

- 大字体显示数量，一目了然
- 图标和标题清晰标识含义
- 可点击交互，双重功能（统计+筛选）

### ⚡ 快速筛选切换

点击统计卡片即可筛选，无需额外的筛选器控件：

- 单击激活筛选
- 再次单击取消筛选
- 筛选标签支持点击 `×` 取消

### 🔄 批量操作效率

一次性为多个账户设置相同间隔：

- 节省逐个修改的时间
- 适合新添加账户的初始配置
- 适合定期调整监控策略

### 💡 智能反馈系统

所有操作都有明确的反馈：

- ✅ 成功：绿色提示消息
- ⚠️ 警告：黄色提示消息（如未选择账户）
- ❌ 错误：红色提示消息（如操作失败）
- 🔵 状态：视觉高亮（如筛选状态）

## 典型使用场景

### 场景 1：新添加多个账户后批量设置

```
1. 添加 5 个新账户（默认都是 4 小时间隔）
2. 查看统计：4時間間隔 = 5
3. 决定其中 3 个改为 30 分钟监控
4. 勾选这 3 个账户
5. 点击"一括設定 (3)" → "30分ごとに設定"
6. 确认修改
7. 查看统计更新：30分間隔 = 3, 4時間間隔 = 2
```

### 场景 2：查看并调整高频监控账户

```
1. 点击"30分間隔"统计卡片
2. 表格只显示 30 分钟间隔的账户
3. 发现某个账户不需要这么频繁
4. 直接在表格中将其改为"4時間ごと"
5. 统计自动更新：30分間隔减 1, 4時間間隔加 1
6. 点击筛选标签的 × 恢复显示所有账户
```

### 场景 3：按类型组织账户

```
1. 将重要新闻账户设置为 30 分钟
2. 将活跃账户设置为 1 小时
3. 将普通账户设置为 4 小时
4. 将不活跃账户设置为 12 小时
5. 使用统计卡片快速切换查看各类型账户
```

## 技术实现

### 状态管理

```javascript
const [selectedRowKeys, setSelectedRowKeys] = useState([]); // 选中的行
const [filterInterval, setFilterInterval] = useState(null); // 筛选间隔
```

### 统计计算

```javascript
const intervalStats = {
  30: accountsData.filter((a) => a.monitoring_interval === 30).length,
  60: accountsData.filter((a) => a.monitoring_interval === 60).length,
  240: accountsData.filter((a) => a.monitoring_interval === 240).length,
  720: accountsData.filter((a) => a.monitoring_interval === 720).length,
};
```

### 筛选逻辑

```javascript
const filteredAccounts = filterInterval
  ? accountsData.filter((a) => a.monitoring_interval === filterInterval)
  : accountsData;
```

### 批量更新

```javascript
await Promise.all(
  selectedRowKeys.map((id) =>
    monitorAPI.updateAccount(id, { monitoring_interval: interval })
  )
);
```

## 性能优化

1. **React Query 缓存** - 避免不必要的 API 请求
2. **本地计算统计** - 无需额外 API 调用
3. **并行批量更新** - 使用 `Promise.all` 提高效率
4. **智能刷新** - 只在必要时刷新整个列表

## 键盘快捷键

| 操作          | 快捷键           |
| ------------- | ---------------- |
| 全选/取消全选 | 点击表头复选框   |
| 取消筛选      | 点击筛选标签的 × |

## 浏览器兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## 移动端适配

统计卡片在小屏幕设备上会自动调整：

- 使用响应式栅格布局（`Row` + `Col`）
- 卡片自动换行显示
- 表格支持横向滚动

## 未来改进

可以考虑的增强功能：

- [ ] 支持保存常用的筛选条件
- [ ] 添加监控间隔建议功能（根据账户活跃度）
- [ ] 批量操作支持更多功能（批量启用/停止等）
- [ ] 导出/导入账户配置
- [ ] 监控间隔历史记录

## 相关文档

- [监控计划技术文档](./MONITORING_SCHEDULE.md)
- [监控计划快速入门](./MONITORING_QUICKSTART.md)

---

**版本**: 1.0  
**更新日期**: 2025-11-09  
**作者**: Auto Ski Info Subscribe Team
